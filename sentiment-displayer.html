<link rel="import" href="../polymer/polymer.html">
<link rel="import" href="../iron-icons/iron-icons.html">
<link rel="import" href="../iron-icon/iron-icon.html">
<link rel="import" href="../iron-icons/maps-icons.html">
<link rel="import" href="../iron-icons/social-icons.html">
<link rel="import" href="../jquery/social-icons.html">
<dom-module id="sentiment-displayer">
  <link rel="import" type="css" href="sentiment.css">
  <script src="bower_components/d3/d3.min.js"></script>
  <script src="bower_components/jquery/dist/jquery.min.js"></script>  
  <template>
    <input type="text" name="time1" id="time1" value$="{{initialtime}}">
    <input type="text" name="time2" id="time2" value$="{{finaltime}}">
    <button onclick="setTime();"></button>
    <div id="content">
    </div>
    <script>
                  var w = window.innerWidth/2;//this.$(content).width();

              var h = window.innerHeight/2; //this.$(content).height();
              var waum = w + 10//this.$(content).width();

              var haum = h + 10 //this.$(content).height();
              var svgContainer = d3.select("#content").append("svg")
                                                   .attr("width", waum + 50)
                                                   .attr("height", haum);
              
              console.log(w + " " + h);
              var hred= h -10;
              var hmed= h/2;
              //Create the Scale we will use for the Axis
              var n = 1;

              //Create the Axis
              //Create an SVG group Element for the Axis elements and call the xAxis function
              var jsonCircles = {{data}};


              var circles = svgContainer.selectAll("#content")
                                        .data(jsonCircles)
                                        .enter()
                                        .append("circle");  
              var y0 = d3.scale.linear().domain([-1,1]).range([0, -hred]);
              var yAxis = d3.svg.axis().scale(y0).orient("left").ticks(5);

              function setTime(){
              var t1 = document.getElementById("time1");
              var t2 = document.getElementById("time2");
              n = t2.value - t1.value;
                axisScale = d3.scale.linear().domain([t1.value, t2.value]).range([0, w]);
                      xAxis = d3.svg.axis().scale(axisScale);
                      d3.select("svg").select("g").remove();
                      
                      d3.select("svg").select("g").remove();
                      d3.select("path").remove();
                      axisGroup = svgContainer.append("g").attr("transform", "translate( 50 ," + hmed + ")").call(xAxis);
                      circleAttributes = circles
                                       .attr("cx", function (d) { return d.sec*w/n +50 - t1.value*w/n; })
                                       .attr("cy", function (d) { return -d.sentiment * hmed*0.5+ hmed; })
                                       .attr("r", function (d) { return 5; }); 
                        lineFunction = d3.svg.line()
                                          .x(function(d) { return d.sec*w/n +50 - t1.value*w/n; })
                                          .y(function(d) { return -d.sentiment * hmed*0.5+ hmed; })
                                          .interpolate("linear");               
                        lineGraph = svgContainer.append("path")
                                            .attr("d", lineFunction(jsonCircles))
                                            .attr("stroke", "blue")
                                            .attr("stroke-width", 2)
                                            .attr("fill", "none");
                      axisGroup = svgContainer.append("g").attr("transform", "translate( 50,"+ h + ")").call(yAxis);
                        
                    }
    </script>
  </template>

    <script>
      //Create the SVG Viewport
    
      var numberMax = 0;
        Polymer({
            is: 'sentiment-displayer',
            properties: {
              finaltime: {
                type: String,
                value: '',
                observer: '_dataChanged'  
              },
              initialtime: {
                type: String,
                value: '',
                observer: '_dataChanged'  
              },
              data: {
                type: Object,
                observer: '_dataChanged'              
              }
            },
            _dataChanged: function() {
              console.log("data has changed")
              if(this.data == undefined){
                console.log("No data");
                return;
              }
              this.setTime();

            },
            ready: function(){
              
              

            	       

            }

        });
    </script>

</dom-module>
